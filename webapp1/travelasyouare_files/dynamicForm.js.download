"use strict";var wix;!function(a){var b;!function(a){var b;!function(a){angular.module("bookingsDynamicForm",["ngMessages","schedulerCommonStatics"])}(b=a.form||(a.form={}))}(b=a.bookings||(a.bookings={}))}(wix||(wix={}));var wix;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a}();b.FULL="Full",b.PARTIAL="Partial",a.DynamicAttributeDisplayTypes=b;var c=function(){function a(){}return a}();c.SHORT_TEXT="SHORT_TEXT",c.LONG_TEXT="LONG_TEXT",c.EMAIL="EMAIL",c.PHONE="PHONE_NUMBER",c.DROP_DOWN="DROP_DOWN",c.NUMBER="NUMBER",a.DynamicFormValueTypes=c;var d=function(){function a(){}return a}();d.FULL_NAME="FullName",d.EMAIL="Email",d.CUSTOM_FIELD="Custom",d.PHONE="PhoneNumber",d.MESSAGE="Message",d.ADDRESS="Address",d.CITY="City",d.STREET="Street",d.STATE="State",d.ZIP="ZipCode",d.APARTMENT="AptFloorNo",d.NUM_OF_PARTICIPANTS="NumberOfParticipants",d.isAddressProperty=function(a){return["Street","AptFloorNo","City","State","ZipCode"].indexOf(a)>-1},a.DynamicFormFieldTypes=d;var e=function(){function a(){}return a}();e.PRISTINE="Default",e.DIRTY="OwnerCustomized",a.DynamicFormSources=e;var f=function(){function a(a){void 0===a&&(a={});var b={fieldType:d.CUSTOM_FIELD,valueType:c.SHORT_TEXT,label:"",displayType:"Full",isReadOnly:!1};Object.assign(this,b,a)}return a}();a.DynamicFormAttribute=f}(b=a.form||(a.form={}))}(b=a.bookings||(a.bookings={}))}(wix||(wix={}));var wix;!function(a){var b;!function(a){var b;!function(a){var b=function(){function a(){}return a}();b.API_PREFIX="_api/scheduler-server/visitor/",b.DYNAMIC_FORM_API_PREFIX=b.API_PREFIX+"bookingsForm/",a.DynamicFormApiConst=b;var c=function(){function a(a,c){var d=this;this.$http=a,this.commonApiBase=c,this.gettingBookingsDynamicForm=this.commonApiBase.httpWrapper(function(a){var c=a.isDummyOffering?"preview":a.offeringType,e=a.isDummyOffering?"":a.offeringId+"/"+("GROUP"===a.offeringType?a.offeringInstanceId+"/":"");return d.$http.get(""+b.DYNAMIC_FORM_API_PREFIX+c+"/"+e)})}return a.$inject=["$http","commonApiBase"],a}();a.DynamicFormApiSrv=c,angular.module("bookingsDynamicForm").service("dynamicFormApiSrv",c)}(b=a.form||(a.form={}))}(b=a.bookings||(a.bookings={}))}(wix||(wix={}));var wix;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(a,b,c){this.dynamicFormApiSrv=a,this.experimentsEnabler=b,this.$q=c}return b.$inject=["dynamicFormApiSrv","experimentsEnabler","$q"],b.prototype.gettingBookingsDynamicForm=function(a,c,d){return this.experimentsEnabler.isBookingsFormEnabled()?this.dynamicFormApiSrv.gettingBookingsDynamicForm(a).then(function(c){return b.overrideLegacyInfo(a,c)}).then(function(a){return b.enrichFormDataWithContactInfo(a,c,d)}):this.$q.when(b.EMPTY_DEFAULT_FORM)},b.overrideLegacyInfo=function(c,d){if(c.legacyLabels&&b.isNeverModifiedByOwner(d)){if(c.legacyLabels.message){var e=d.form.fields.find(function(b){return b.fieldType===a.DynamicFormFieldTypes.MESSAGE});e&&(e.label=c.legacyLabels.message)}d.form.actions.onlinePaymentLabel=c.legacyLabels.onlinePayment||d.form.actions.onlinePaymentLabel,d.form.actions.offlinePaymentLabel=c.legacyLabels.offlinePayment||d.form.actions.offlinePaymentLabel}return d},b.isNeverModifiedByOwner=function(b){return b.source===a.DynamicFormSources.PRISTINE},b.enrichFormDataWithContactInfo=function(a,c,d){var e={},f=c.dynamicFormData;if(e.name=c.name||d.fullName,e.phone=c.phone||d.phoneNumber,e.email=c.email||d.email,e.message=c.message,e.address=c.address||{},a.form.fields=a.form.fields.map(function(a){return b.updateDynamicFormAttributeByLegacyContactInfo(a,e,d)}),f&&f.form&&f.form.fields){var g=new Map;b.createDynamicFormFieldValueMap(g,f.form.fields),a.form.fields=a.form.fields.map(function(a){return b.updateDynamicFormAttributeWithExistingDynamicForm(a,g)})}return a},b.createDynamicFormFieldValueMap=function(a,c){c.forEach(function(c){a.set(c.id,c.value),c.subFields&&c.subFields.length>0&&b.createDynamicFormFieldValueMap(a,c.subFields)})},b.prototype.enrichContactInfoWithFormData=function(a,c){c&&c.form&&c.form.fields&&c.form.fields.forEach(function(c){return b.updateContactInfoByDynamicFormAttribute(a,c)})},b.updateDynamicFormAttributeByLegacyContactInfo=function(c,d,e){var f=new a.DynamicFormAttribute(c);switch(c.fieldType){case a.DynamicFormFieldTypes.FULL_NAME:f.value=d.name||f.value;break;case a.DynamicFormFieldTypes.PHONE:f.value=d.phone||f.value;break;case a.DynamicFormFieldTypes.EMAIL:f.value=d.email||f.value,f.isReadOnly=!!e.email;break;case a.DynamicFormFieldTypes.MESSAGE:f.value=d.message||f.value;break;case a.DynamicFormFieldTypes.ADDRESS:f.subFields=b.updateDynamicFormAddressAttributeByLegacyContactInfo(f,d.address)}return f},b.updateDynamicFormAddressAttributeByLegacyContactInfo=function(b,c){return b.subFields.map(function(b){var d=new a.DynamicFormAttribute(b);switch(d.displayType=a.DynamicAttributeDisplayTypes.PARTIAL,d.fieldType){case a.DynamicFormFieldTypes.STREET:d.value=c.addressLine,d.displayType=a.DynamicAttributeDisplayTypes.FULL;break;case a.DynamicFormFieldTypes.CITY:d.value=c.city;break;case a.DynamicFormFieldTypes.APARTMENT:d.value=c.aptOrFloor}return d})},b.updateDynamicFormAttributeWithExistingDynamicForm=function(a,c){var d=c.get(a.id);return a.value=d||a.value,a.subFields&&a.subFields.length>0&&(a.subFields=b.updateSubFieldsAttributesWithExistingDynamicForm(a,c)),a},b.updateSubFieldsAttributesWithExistingDynamicForm=function(a,c){return a.subFields.map(function(a){return b.updateDynamicFormAttributeWithExistingDynamicForm(a,c)})},b.updateContactInfoByDynamicFormAttribute=function(c,d){switch(d.fieldType){case a.DynamicFormFieldTypes.FULL_NAME:c.name=d.value;break;case a.DynamicFormFieldTypes.PHONE:c.phone=d.value;break;case a.DynamicFormFieldTypes.EMAIL:c.email=d.value;break;case a.DynamicFormFieldTypes.MESSAGE:c.message=d.value;break;case a.DynamicFormFieldTypes.ADDRESS:c.address=c.address||{},d.subFields.forEach(function(a){return b.updateAddressByDynamicFormAttribute(c.address,a)})}},b.updateAddressByDynamicFormAttribute=function(b,c){if(c.value)switch(c.fieldType){case a.DynamicFormFieldTypes.STREET:b.addressLine=c.value;break;case a.DynamicFormFieldTypes.CITY:b.city=c.value;break;case a.DynamicFormFieldTypes.APARTMENT:b.aptOrFloor=c.value}},b.prototype.countRequiredFields=function(a){var b=function(a){return a?a.reduce(function(a,c){return a+(c.userConstraints&&c.userConstraints.required?1:0)+b(c.subFields)},0):0};return a&&a.form?b(a.form.fields):0},b}();b.EMPTY_DEFAULT_FORM={source:a.DynamicFormSources.PRISTINE,form:{fields:[],id:null,header:{title:null,description:null,isDescriptionHidden:!0},actions:{onlinePaymentLabel:null,offlinePaymentLabel:null}}},a.DynamicFormSrv=b,angular.module("bookingsDynamicForm").service("dynamicFormSrv",b)}(b=a.form||(a.form={}))}(b=a.bookings||(a.bookings={}))}(wix||(wix={}));var wix;!function(a){var b;!function(a){var b;!function(a){var b=function(){function b(a,b,c,d){this.$compile=a,this.$element=b,this.$scope=c,this.$filter=d,this.escapeHtml=d("escapeHtml"),this.notifyDropDownAttributeValueExist()}return b.$inject=["$compile","$element","$scope","$filter"],b.prototype.notifyDropDownAttributeValueExist=function(){this.attribute.value&&this.isDropDown()&&this.onAttributeValueChanged()},b.prototype.getInputNodeName=function(){var b="";switch(this.attribute.valueType){case a.DynamicFormValueTypes.SHORT_TEXT:case a.DynamicFormValueTypes.EMAIL:case a.DynamicFormValueTypes.PHONE:case a.DynamicFormValueTypes.NUMBER:b="input";break;case a.DynamicFormValueTypes.LONG_TEXT:b="textarea"}return b},b.prototype.getInputTypeByValueType=function(){var b="";switch(this.attribute.valueType){case a.DynamicFormValueTypes.EMAIL:b="email";break;case a.DynamicFormValueTypes.PHONE:b="tel";break;case a.DynamicFormValueTypes.NUMBER:b="number";break;default:b="text"}return b},b.prototype.onValidValueSelected=function(a){this.attribute.value=a,this.onAttributeValueChanged()},b.prototype.onAttributeValueChanged=function(){this.onAttributeChanged({attribute:this.attribute})},b.prototype.renderDropDown=function(){var b="";if(this.attribute.valueType===a.DynamicFormValueTypes.DROP_DOWN)this.dropDownValidValues=this.attribute.validValues.map(function(a){return{value:a.id,label:a.label}}),b=this.generateDropDownTemplate();else if(this.attribute.fieldType===a.DynamicFormFieldTypes.NUM_OF_PARTICIPANTS){var c=1,d=this.attribute.userConstraints.max;if(d>1){this.dropDownValidValues=[];for(var e=c;d>=e;e++)this.dropDownValidValues.push({value:e,label:""+e});b=this.generateDropDownTemplate("max-participants-dropdown")}}return b},b.prototype.generateDropDownTemplate=function(a){var b=this;void 0===a&&(a="dynamic-form-attribute-dropdown");var c=this.dropDownValidValues.indexOf(this.dropDownValidValues.find(function(a){return a.value===b.attribute.value})),d=c>-1?'selected-item="$ctrl.dropDownValidValues['+c+']"':"";return'<boost-dropdown data-hook="'+a+'"\n                              items="$ctrl.dropDownValidValues"\n                              on-select="$ctrl.onValidValueSelected(value)"\n                              custom-class="dropdown--input dropdown--input__form"\n                              '+d+"></boost-dropdown>"},b.prototype.isInvalid=function(){var a=this.attribute.id;return this.formController[a]&&this.formController[a].$dirty&&this.formController[a].$invalid},b.prototype.shouldRenderTemplate=function(){return!(this.isSubFieldExist()||this.hasOneParticipant())},b.prototype.hasOneParticipant=function(){return this.isNumberOfParticipantAttribute()&&this.attribute.userConstraints.max<=1},b.prototype.isNumberOfParticipantAttribute=function(){return this.attribute.fieldType===a.DynamicFormFieldTypes.NUM_OF_PARTICIPANTS},b.prototype.isSubFieldExist=function(){return this.attribute.subFields&&this.attribute.subFields.length>0},b.prototype.isRequired=function(){return this.attribute.userConstraints&&this.attribute.userConstraints.required?"required":""},b.prototype.shouldRenderLabel=function(){return!0},b.prototype.getSubComponentToRender=function(){return"bks-dynamic-form-attribute"},b.prototype.getPlaceholder=function(){return""},b.prototype.isAttributeWithSubElements=function(){return!1},b.prototype.hasTextAreaAutoScale=function(){return!1},b.prototype.mapCamelCaseToDashed=function(){return this.attribute.fieldType.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},b.prototype.getInputConstrains=function(){var b="";switch(this.attribute.valueType){case a.DynamicFormValueTypes.SHORT_TEXT:case a.DynamicFormValueTypes.EMAIL:case a.DynamicFormValueTypes.PHONE:b+='maxlength="40"';break;case a.DynamicFormValueTypes.LONG_TEXT:b+='maxlength="255"'}return b},Object.defineProperty(b.prototype,"label",{get:function(){var a=this.isRequired();return""+(a?"* ":"")+this.escapeHtml(this.attribute.label)},enumerable:!0,configurable:!0}),b.prototype.updateNumberOfParticipantValue=function(){this.isNumberOfParticipantAttribute()&&1===this.attribute.userConstraints.max&&(this.attribute.value=1,this.onAttributeChanged({attribute:this.attribute}))},b.prototype.isDropDown=function(){return this.isNumberOfParticipantAttribute()||this.attribute.valueType===a.DynamicFormValueTypes.DROP_DOWN},b.prototype.renderInput=function(a,b,c){var d=this.getInputNodeName(),e=this.getInputTypeByValueType(),f=this.getPlaceholder(),g=this.hasTextAreaAutoScale(),h=c+" "+this.getInputConstrains();return"<"+d+' data-hook = "dynamic-form-attribute-input"\n                        id="'+a+'"\n                        ng-model="$ctrl.attribute.value"\n                        ng-change="$ctrl.onAttributeValueChanged()"\n                        class="dynamic-form-attribute__input input"\n                        name="'+a+'"\n                        type="'+e+'"\n                        '+(b?"disabled":"")+"\n                        "+h+'\n                        placeholder="'+f+'"\n                        '+(g?'auto-scale-text-area rows="1"':"")+'\n                        tabindex="0"/>'},b.prototype.getContactInfoClass=function(){return this.isAttributeWithSubElements()?"contact-info-input":""},b.prototype.$onInit=function(){var a=this.isRequired(),b=this.attribute.id,c=this.attribute.isReadOnly,d=this.getSubComponentToRender(),e=this.mapCamelCaseToDashed(),f=this.shouldRenderTemplate(),g=this.getContactInfoClass(),h='<div data-hook="dynamic-form-attribute-input-container" class="dynamic-form-attribute--container dynamic-form-attribute--container__'+this.attribute.displayType+'">\n            <div data-hook="dynamic-form-attribute-'+this.attribute.fieldType+'" class="dynamic-form-attribute dynamic-form-attribute__'+e+" "+g+'" \n                    ng-class="{\'dynamic-form-attribute__invalid\': $ctrl.isInvalid() }">\n            '+(f&&this.shouldRenderLabel()?'<label data-hook="dynamic-form-attribute-label"\n                                    for="'+b+'"\n                                    class="label">'+this.label+"</label>":"")+"\n             "+(f?'<div class="dynamic-form-attribute__input-container">\n               '+(this.isDropDown()?this.renderDropDown():this.renderInput(b,c,a))+'\n               <div ng-if="'+c+'"\n                    data-hook="dynamic-form-attribute-lock"\n                    class="dynamic-form-attribute__disabled-indication scheduler-svg-font-icons-lock">\n               </div>\n             </div>':"")+'\n            </div>\n            <div ng-if="$ctrl.isInvalid()" ng-messages="$ctrl.formController[\''+b+'\'].$error" role="alert"\n                 class="dynamic-form-attribute__validation-message"\n                 data-hook="dynamic-form-attribute-validation-message">\n                 <span ng-message="required">{{\'visitor.contact-info.form.validation.required\' | translate}}</span>\n                 <span ng-message="email">{{\'visitor.contact-info.form.validation.email\' | translate}}</span>\n            </div>\n           </div>\n          <'+d+'\n             ng-repeat="subField in $ctrl.attribute.subFields"\n             data-hook="dynamic-dynamic-form-attribute-sub-field"\n             attribute="subField"/>',i=angular.element(h);this.$element.append(i),this.$compile(i)(this.$scope),this.updateNumberOfParticipantValue()},b}();a.DynamicFormAttributeComponent=b,angular.module("bookingsDynamicForm").component("bksDynamicFormAttribute",{template:"",controller:b,require:{formController:"^form"},bindings:{attribute:"=",onAttributeChanged:"&"}})}(b=a.form||(a.form={}))}(b=a.bookings||(a.bookings={}))}(wix||(wix={}));